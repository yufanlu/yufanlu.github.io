<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Productivity Booster: Ultisnips · Yufan Lu</title><meta name="description" content="Productivity Booster: Ultisnips - Yufan Lu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yufanlu.net/atom.xml" title="Yufan Lu"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.ico" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archives</a></li><li class="nav-list-item"><a href="https://github.com/yufanlu" target="_blank" class="nav-list-link">GitHub</a></li><li class="nav-list-item"><a href="https://ca.linkedin.com/in/luyufan" target="_blank" class="nav-list-link">LinkedIn</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Productivity Booster: Ultisnips</h1><div class="post-info">Oct 30, 2016<span class="post-meta-divider">|</span><a href="/categories/vim/" class="post-category">vim</a></div><div class="post-content"><p><a href="https://github.com/SirVer/ultisnips" target="_blank" rel="external">UltiSnips</a> is a really powerful vim plugin that boosts your productivity by saving you from typing redundant code patterns or repeated configurations. And <a href="https://github.com/SirVer/ultisnips" target="_blank" rel="external">UltiSnips</a> provides an easy way to create and use snippets:</p>
<ol>
<li>Snippets are organized by file type: <code>cpp.snippets</code> for <code>c++</code> and <code>pandoc.snippets</code> for <code>pandoc</code>.</li>
<li>Any changes made to snippets will take effect after you save them. So you can create and edit snippets on the fly.</li>
</ol>
<p>For example, writing the following <code>c++</code> code can be really easy (and quick):</p>
<img src="/2016/10/30/ultisnips/demo1.gif" alt="demo1.gif" title="">
<p>And You will notice a huge difference when you turn off this plugin once you get used to it. There are lots of awesome snippet plugins, such as <a href="https://github.com/Shougo/neosnippet.vim" target="_blank" rel="external">neosnippet</a>.</p>
<a id="more"></a>
<p><a href="https://github.com/SirVer/ultisnips" target="_blank" rel="external">UltiSnips</a> is more like a snippet engine while you actually need a separate plugin for your “snippet collection”. And <a href="https://github.com/SirVer/ultisnips" target="_blank" rel="external">offical document</a> of <a href="https://github.com/SirVer/ultisnips" target="_blank" rel="external">UltiSnips</a> uses <a href="https://github.com/honza/vim-snippets" target="_blank" rel="external">vim-snippets</a> as the “collection plugin”.</p>
<h2 id="Installation-of-UltiSnips-and-vim-snippets"><a href="#Installation-of-UltiSnips-and-vim-snippets" class="headerlink" title="Installation of UltiSnips and vim-snippets"></a>Installation of UltiSnips and vim-snippets</h2><p>If you use <a href="https://github.com/junegunn/vim-plug" target="_blank" rel="external">vim-plug</a>, all you need to do is to provide the repo name for <code>UltiSnips</code> and <code>vim-snippets</code> in <code>vimrc</code> like the following. Reload vim and run <code>:PlugInstall</code>.</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">" vim-plug</span></div><div class="line"><span class="keyword">call</span> plug#begin(<span class="string">'~/.vim/plugged'</span>)</div><div class="line"></div><div class="line">Plug <span class="string">'SirVer/ultisnips'</span></div><div class="line">Plug <span class="string">'honza/vim-snippets'</span></div><div class="line"></div><div class="line"><span class="keyword">call</span> plug#end()<span class="comment">"</span></div></pre></td></tr></table></figure>
<p>And here is a screenshot of snippets provided by <code>vim-snippets</code>:</p>
<img src="/2016/10/30/ultisnips/snips.png" alt="snips.png" title="">
<h2 id="UltiSnips-requirement-and-how-it-works"><a href="#UltiSnips-requirement-and-how-it-works" class="headerlink" title="UltiSnips requirement and how it works"></a>UltiSnips requirement and how it works</h2><p>In order to use <code>UltiSnips</code>, vim needs <code>python</code> or <code>python3</code> support, which can be checked by running</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">:<span class="keyword">echo</span> <span class="built_in">has</span>(<span class="string">"python"</span>)   <span class="comment">" if you use python 2.7</span></div><div class="line">:<span class="keyword">echo</span> <span class="built_in">has</span>(<span class="string">"python3"</span>)  <span class="comment">" if you use python 3.3 or 3.4</span></div></pre></td></tr></table></figure>
<p>or you could check you vim version and find out if it has python support by running</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">:<span class="keyword">version</span></div></pre></td></tr></table></figure>
<p>If you saw either <code>+python</code> or <code>+python3</code> in the output, you are good to go. My vim is compiled with python2 support, so I have <code>+python</code> and <code>-python3</code> in the screenshot.</p>
<img src="/2016/10/30/ultisnips/version.png" alt="version.png" title="">
<p>When vim is started, <code>ultisnips</code> will search all folders named <strong>UltiSnips</strong> (by default) under path <code>$VIM</code> and find the corresponding snippet file given the file type you have opened. And the snippets used in the example above are:</p>
<ul>
<li><code>incc</code>, which is expanded as <code>include &lt;iostream&gt;</code></li>
<li><code>main</code>, which is expanded as <code>int main(...){ ... }</code></li>
<li><code>cout</code>, which is expanded as <code>cout &lt;&lt; ... &lt;&lt; endl;</code></li>
</ul>
<p>UltiSnips will expand the keywords for you automatically or by a trigger key. Within each snippet, you can define a jump sequence to move cursor around and edit related content.</p>
<h2 id="Expand-a-snippet"><a href="#Expand-a-snippet" class="headerlink" title="Expand a snippet"></a>Expand a snippet</h2><p>The default key to expand a snippet is <code>&lt;tab&gt;</code>. For example, after we enter <strong>main</strong> and hit <code>&lt;tab&gt;</code>, the word <strong>main</strong> will be replaced with a predefined snippet:</p>
<img src="/2016/10/30/ultisnips/main.gif" alt="main.gif" title="">
<p>and you can use a different key to expand a snippet by changing <code>g:UltiSnipsExpandTrigger</code> in your <code>vimrc</code>.</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> <span class="variable">g:UltiSnipsExpandTrigger</span> = [the key you like]</div></pre></td></tr></table></figure>
<h2 id="Create-a-simple-snippet"><a href="#Create-a-simple-snippet" class="headerlink" title="Create a simple snippet"></a>Create a simple snippet</h2><p>A simple way to do this is to create a folder named <strong>UltiSnips</strong> under path <code>$VIM</code> to collect your customized snippets. Or you can put the folder anywhere you want and then create a link under <code>$vim</code>. Just for fun, let’s create a file named <code>cpp.snippets</code> and put the following snippet in it:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">snippet <span class="built_in">std</span> <span class="string">"use namespace std"</span> b</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line">endsnippet</div></pre></td></tr></table></figure>
<p>And UltiSnips will capture any changes you made when you save the snippet so there is no need to restart your vim.<br><img src="/2016/10/30/ultisnips/std.gif" alt="std.gif" title=""></p>
<p>A snippet is created with the following structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">snippet keyword &quot;description&quot; option</div><div class="line">content</div><div class="line">endsnippet</div></pre></td></tr></table></figure>
<p>In the snippet we just created, <code>std</code> is the <strong>keyword</strong>, and <code>&quot;use namespace std&quot;</code> is the <strong>description</strong> (which will be shown if you use autocomplete plugins like <a href="https://github.com/Valloric/YouCompleteMe" target="_blank" rel="external">YouCompleteMe</a>, <a href="https://github.com/Shougo/neocomplete.vim" target="_blank" rel="external">neocomplete</a>, or <a href="https://github.com/Shougo/deoplete.nvim" target="_blank" rel="external">deoplete</a>), and <code>b</code> is the <strong>option</strong> for the snippet:</p>
<ul>
<li><code>b</code> — snippet can only be expanded if it’s the beginning of the line</li>
<li><code>A</code> — snippet will be expanded automatically</li>
<li><code>w</code> — snippet can be expanded if it’s a “word” to vim (check <code>:help iskeyword</code>). For example, a <strong>word</strong> can be “a sequence of other non-blank characters” according to <code>:help word</code>.</li>
<li><code>i</code> — snippet can be expanded in the middle of a word.</li>
</ul>
<p>Other options such as <code>r</code>, <code>s</code>, <code>t</code>, <code>m</code> and their related description can be found by running:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">:<span class="keyword">help</span> UltiSnips</div></pre></td></tr></table></figure>
<h2 id="Advanced-Sort-of-UltiSnips"><a href="#Advanced-Sort-of-UltiSnips" class="headerlink" title="Advanced (Sort of) UltiSnips"></a>Advanced (Sort of) UltiSnips</h2><p>Let’s write another <code>c++</code> snippet in <code>cpp.snippets</code> for class definition. Save it and enter a <code>c++</code> file. </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">snippet <span class="keyword">class</span> <span class="string">"class"</span> b</div><div class="line"><span class="keyword">class</span> $&#123;<span class="number">1</span>:Class&#125;&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// constructors, asssignment, destructor</span></div><div class="line">    $<span class="number">1</span>();</div><div class="line">    $<span class="number">1</span>(<span class="keyword">const</span> $<span class="number">1</span>&amp;);</div><div class="line">    $<span class="number">1</span>&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> $<span class="number">1</span>&amp;);</div><div class="line">    ~$<span class="number">1</span>();</div><div class="line"><span class="keyword">private</span>:</div><div class="line"></div><div class="line">&#125;;</div><div class="line">endsnippet</div></pre></td></tr></table></figure>
<p>After we expand this snippet, let’s type <strong>BinaryTree</strong>. And we can see that all fields marked as <code>$1</code> are updated as we type.</p>
<img src="/2016/10/30/ultisnips/binarytree.gif" alt="binarytree.gif" title="">
<p>In this snippet, <code>${1:Class}</code> is a placeholder marked as <code>$1</code> with default content <strong>Class</strong>. To define a jump sequence, we use dollar sign followed by numbers like <code>$1</code>, <code>$2</code>, <code>$3</code> …</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">snippet <span class="keyword">class</span> <span class="string">"class"</span> b</div><div class="line"><span class="keyword">class</span> $&#123;<span class="number">1</span>:Class&#125;&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// constructors, asssignment, destructor</span></div><div class="line">    $<span class="number">1</span>();</div><div class="line">    $<span class="number">1</span>(<span class="keyword">const</span> $<span class="number">1</span>&amp;);</div><div class="line">    $<span class="number">1</span>&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> $<span class="number">1</span>&amp;);</div><div class="line">    ~$<span class="number">1</span>();</div><div class="line">    $<span class="number">2</span></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    $<span class="number">3</span></div><div class="line">&#125;;</div><div class="line">endsnippet</div></pre></td></tr></table></figure>
<p>The default key to jump forward and backward is </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">&lt;c-j&gt;</span> <span class="comment">" jump forward</span></div><div class="line"><span class="symbol">&lt;c-k&gt;</span> <span class="comment">" jump backward</span></div></pre></td></tr></table></figure>
<p>After we update the snippet, expand <strong>class</strong>, and type <strong>BinaryTree</strong>, we can jump to the next two placeholders by pressing <code>&lt;c-j&gt;</code> (<code>ctrl + j</code>).</p>
<img src="/2016/10/30/ultisnips/jump.gif" alt="jump.gif" title="">
<h2 id="Visual-Placeholder-in-UltiSnips"><a href="#Visual-Placeholder-in-UltiSnips" class="headerlink" title="Visual Placeholder in UltiSnips"></a>Visual Placeholder in UltiSnips</h2><p>Visual placeholder is another powerful feature. It further reduces the amount of typing by providing you a way to reuse the existing context in the buffer. Suppose we use the following snippet to define a function in <code>c++</code>:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">snippet fun <span class="string">"function definition"</span> b</div><div class="line">$&#123;<span class="number">2</span>:<span class="keyword">void</span>&#125; $&#123;<span class="number">1</span>:name&#125;($<span class="number">3</span>)&#123;</div><div class="line">    $<span class="number">4</span></div><div class="line">&#125;</div><div class="line">endsnippet</div></pre></td></tr></table></figure>
<p>Suppose we have the following line in the buffer and want to use the following content as the function body:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"Vim Rocks!"</span> &lt;&lt; <span class="built_in">endl</span>;</div></pre></td></tr></table></figure>
<p>This could be done in two steps:</p>
<ol>
<li>expand the keyword <strong>fun</strong><img src="/2016/10/30/ultisnips/without_visual1.gif" alt="without_visual1.gif" title=""></li>
<li>move the line and indent<img src="/2016/10/30/ultisnips/without_visual2.gif" alt="without_visual2.gif" title="">
</li>
</ol>
<p>Using the visual placeholder, this can be done in one step with a simple modification.<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">snippet fun <span class="string">"function def"</span> b</div><div class="line">$&#123;<span class="number">2</span>:<span class="keyword">void</span>&#125; $&#123;<span class="number">1</span>:name&#125;($<span class="number">3</span>)&#123;</div><div class="line">    $&#123;<span class="number">4</span>:$&#123;VISUAL&#125;&#125;      <span class="comment">// &lt;--- visual placeholder added</span></div><div class="line">&#125;</div><div class="line">endsnippet</div></pre></td></tr></table></figure></p>
<p>Any selected content under the visual mode will be put into the visual placeholder, <code>${VISUAL}</code> when the snippet is expanded. Thus, instead of moving the line and indent it, we could do</p>
<ol>
<li>select the line under visual mode and hit <code>&lt;TAB&gt;</code></li>
<li>expand the keyword <code>fun</code></li>
</ol>
<img src="/2016/10/30/ultisnips/with_visual.gif" alt="with_visual.gif" title="">
<p>This feature is really helpful when you restructure you text a lot. For example, wrap a paragraph in environment such as <code>enumerate</code>, <code>itemize</code> when writing LaTex.</p>
<h2 id="Python-interpolation-in-UltiSnips"><a href="#Python-interpolation-in-UltiSnips" class="headerlink" title="Python interpolation in UltiSnips"></a>Python interpolation in UltiSnips</h2><p>UltiSnips also allows users to leverage python to accomplish complex tasks. Suppose we want to insert all files in the current directory, we can write a simple python function to do this. We the following function in <code>cpp.snippets</code>. Here, <code>!p</code> means <code>python</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">global</span> !p</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_files</span><span class="params">()</span>:</span></div><div class="line">    files = []</div><div class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(<span class="string">'.'</span>):</div><div class="line">        <span class="keyword">if</span> f.endswith((<span class="string">'.cpp'</span>, <span class="string">'.h'</span>, <span class="string">'.cc'</span>)) <span class="keyword">and</span> <span class="keyword">not</span> f.startswith(<span class="string">'.'</span>):</div><div class="line">            files.append(f)</div><div class="line">    <span class="keyword">return</span> <span class="string">' '</span>.join(files)</div><div class="line">endglobal</div></pre></td></tr></table></figure>
<p>Then, we could call this function when we write other snippets.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">snippet ls <span class="string">"list source files"</span> iw</div><div class="line">`!p snip.rv = list_files()`     <span class="comment">// snip.rv means "snip return value"</span></div><div class="line">endsnippet</div></pre></td></tr></table></figure>
<p>Suppose we have two files in the folder: <code>ultisnip.cpp</code> and <code>ultisnip.h</code>.</p>
<img src="/2016/10/30/ultisnips/python.gif" alt="python.gif" title="">
<p>And here is the <a href="http://vimzijun.net/2016/10/30/ultisnip/" target="_blank" rel="external">link</a> to the Chinese version of this post.</p>
<h3 id="Great-Tutorials-on-UltiSnips"><a href="#Great-Tutorials-on-UltiSnips" class="headerlink" title="Great Tutorials on UltiSnips"></a>Great Tutorials on UltiSnips</h3><ul>
<li><a href="https://github.com/SirVer/ultisnips#user-content-screencasts" target="_blank" rel="external">Screencasts</a> listed by the official document</li>
<li><a href="http://vimcasts.org/episodes/meet-ultisnips/" target="_blank" rel="external">Meet UltiSnips</a></li>
<li><a href="http://vimcasts.org/episodes/ultisnips-python-interpolation/" target="_blank" rel="external">Using Python interpolation in UltiSnips snippets</a></li>
<li><a href="http://vimcasts.org/episodes/ultisnips-visual-placeholder/" target="_blank" rel="external">Using selected text in UltiSnips snippets</a></li>
</ul>
</div></article><div class="post-tags"><a href="/tags/vim/" class="post-tag"># vim</a><a href="/tags/vimrc/" class="post-tag"># vimrc</a><a href="/tags/ultisnips/" class="post-tag"># ultisnips</a></div></div></main><footer><div class="paginator"><a href="/2016/07/13/easy-vim-setup/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'yufanlu';
var disqus_identifier = '2016/10/30/ultisnips/';
var disqus_title = 'Productivity Booster: Ultisnips';
var disqus_url = 'http://yufanlu.net/2016/10/30/ultisnips/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//yufanlu.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 - 2018 <a href="http://yufanlu.net">Yufan Lu</a>. This is a personal weblog. All the information provided on yufanlu.net is expressed opinion of myself, Yufan Lu and not others. This includes (but is not limited to) my membership organizations and/or employers. Any notes or knowledge summaries posted serves as personal remainders and for personal reference purpose only (and they might be wrong). Before making any decisions or taking any actions, you should consult a professional adviser. Under no circumstances will I be liable for any loss or damages (including without limitation indirect or consequential loss or damages) or any loss or damages whatsoever arising from loss of data or profits arising out of or in connection with the use of this website.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80837966-1",'auto');ga('send','pageview');</script></body></html>